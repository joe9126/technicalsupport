$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}});$("#savecsrBtn").clone();$(document).ready(function(){$("#projectslist_table").on("click","tbody tr",function(){var s=$(this).closest("tr").attr("id"),e=$(this).children("td:nth-child(3)").text();console.log("ticket no is: "+e),$("#claimslist").fadeOut(),$("#claimslist").css("display","none"),$("#claimupdate").slideDown("slow"),w(s,e)})});$("#showlist").click(function(){$("#claimupdate").css("display","none").fadeOut(2e3),$("#claimslist").fadeIn(2e3),document.location.reload()});function w(s,e){$("#claimupdateform").trigger("reset"),$.ajax({type:"get",url:"ticketclaims/showclaim",data:{ticketno:s,jobcardno:e},dataType:"json",contentType:"false",processData:"false",success:function(t){var a=moment(t[0].start_time).format("Do MMM, YYYY"),n="Ticket "+t[0].ticketno+" "+t[0].clientname+", "+t[0].location+" On "+a;$("#cardtitle").text(n),$("#jobcardno").val(t[0].jobcardno),$("#cardtitle-claimamount").text("| Kes. "+$.number(t[0].claimamount,2));var l=t[0].claimstatus;l==null?$("#cardtitle-claimstatus").text("Unclaimed"):$("#cardtitle-claimstatus").text(l),$("#jobcardno").val(t[0].jobcardno),$("#ticketno").val(t[0].ticketno),$("#busfare").val(t[0].psvfare),$("#lunch").val(t[0].lunch),$("#dinner").val(t[0].dinner),$("#accommodation").val(t[0].accommodation),$("#petties").val(t[0].petties),$("#kmtravel").val(t[0].km),$("#others").val(t[0].others),$("#laundry").val(t[0].laundry),$("#kmclaim").val($.number(t[0].kmclaim,2))},error:function(t){console.log("Error sending data."),console.log(t)}})}$(document).ready(function(){$(".calc").keyup(function(){var s=parseFloat($("#busfare").val())+parseFloat($("#lunch").val())+parseFloat($("#dinner").val())+parseFloat($("#accommodation").val())+parseFloat($("#petties").val())+parseFloat($("#kmclaim").val().replace(",",""))+parseFloat($("#laundry").val())+parseFloat($("#others").val());$("#cardtitle-claimamount").text("| Kes. "+$.number(s,2))}),$("#kmtravel").keyup(function(){var s=parseFloat($("#kmtravel").val()),e=0,t=40,a=20;if($("#zone").val()=="Nairobi")e=s*t,$("#kmclaim").val(e);else if(s>40){var n=0;n=s-40,e=t*40+n*a,$("#kmclaim").val(e)}else e=t*s,$("#kmclaim").val(e);var l=parseFloat($("#busfare").val())+parseFloat($("#lunch").val())+parseFloat($("#dinner").val())+parseFloat($("#accommodation").val())+parseFloat($("#petties").val())+parseFloat($("#laundry").val())+parseFloat($("#others").val())+parseFloat($("#kmclaim").val().replace(",",""));$("#cardtitle-claimamount").text("| Kes. "+$.number(l,2))})});$("#travelmode").on("change",function(){$(this).val()=="Private"?($(".kmtravel").css("display","block"),$(".zone").css("display","block"),$(".busfare").css("display","none"),$(".companyprovided").css("display","none")):$(this).val()=="Public"?($(".companyprovided").css("display","none"),$(".kmtravel").css("display","none"),$(".zone").css("display","none"),$(".busfare").css("display","block")):($(".zone").css("display","none"),$(".companyprovided").css("display","block"),$(".kmtravel").css("display","none"),$(".busfare").css("display","none"))});$("#zone").on("change",function(){$(this).val()=="Nairobi"?($("#rate").val("KES. 40 per km"),$("#rate").css({"font-size":"14px"})):($("#rate").val("@KES. 40 for 1st 40km, @Kes.20 extra km "),$("#rate").css({"font-size":"13px"}))});$("#claimupdateform").on("submit",function(s){s.preventDefault();var e=$("#cardtitle-claimstatus").text();if(e=="Claimed")$(".message").text("This ticket is already claimed. Contact admin."),$("#alertmessage2").removeClass("alert-success"),$("#alertmessage2").addClass("alert-danger"),$("#alertmessage2").css("display","block").fadeOut(4e3);else if($("#claimupdateform").parsley(),$("#claimupdateform").parsley().isValid()){var t=parseFloat($("#busfare").val())+parseFloat($("#lunch").val())+parseFloat($("#dinner").val())+parseFloat($("#accommodation").val())+parseFloat($("#petties").val())+parseFloat($("#laundry").val())+parseFloat($("#others").val())+parseFloat($("#kmclaim").val().replace(",",""));if(window.FormData!==void 0){var a=new FormData;a.append("ticketno",$("#ticketno").val()),a.append("jobcardno",$("#jobcardno").val()),a.append("psvfare",$("#busfare").val()),a.append("accommodation",$("#accommodation").val()),a.append("petties",$("#petties").val()),a.append("dinner",$("#dinner").val()),a.append("lunch",$("#lunch").val()),a.append("kmclaim",$("#kmclaim").val().replace(",","")),a.append("km",$("#kmtravel").val()),a.append("claimtotal",t),a.append("laundry",$("#laundry").val()),a.append("others",$("#others").val());var n=$("#claimsubmit").clone();$.ajax({url:"claimupdate",method:"post",data:a,processData:!1,contentType:!1,beforeSend:function(){var l='<div class="spinner-border spinner-border-sm text-light fs-5" role="status"><span class="visually-hidden">Loading...</span></div>';$("#claimsubmit").html(l+" Updating...")},success:function(l){$("#claimsubmit").replaceWith(n),l.success==!0?($(".message").text(l.message),$("#alertmessage2").removeClass("alert-danger"),$("#alertmessage2").addClass("alert-success"),$("#alertmessage2").css("display","block").fadeOut(3e3),$("#alertmessage2")[0].scrollIntoView(),$("#claimupdateform")[0].reset(),$("#claimupdateform").parsley().reset()):($("#claimsubmit").replaceWith(n),$(".message").text(l.message),$("#alertmessage2").removeClass("alert-success"),$("#alertmessage2").addClass("alert-danger"),$("#alertmessage2").css("display","block").fadeOut(3e3))},error:function(l){$(".message").text("An error occured. Claim was not updated"),$("#alertmessage2").removeClass("alert-success"),$("#alertmessage2").addClass("alert-danger"),$("#alertmessage2").css("display","block").fadeOut(3e3),console.log("Error sending data."),console.log(l)}})}}});$("#removeclaimbtn").click(function(){var s=$("#claimprinttable").find(":checked").length;if(!s)$(".message").text("Select at least one claim."),$("#alertmessage").removeClass("alert-success"),$("#alertmessage").addClass("alert-danger"),$("#alertmessage").css("display","block").fadeOut(3e3);else{$("#claimprinttable tbody tr").find('input[name="flexCheckDefault"]').each(function(){$(this).is(":checked")&&$(this).parents("tr").remove()});for(var e=$("#claimprinttable >tbody >tr").length,t=0,a=0,n=1;n<=e;n++)a=$("#claimprinttable tbody tr:nth-child("+n+")").find("td:nth-child(11)").text().replace("KES. ",""),a=parseFloat(a.replace(",","")),t+=a;$("#totalamounttxt").text("KES. "+$.number(t,2))}});$("#deleteclaimbtn").click(function(){var s=$("#claimprinttable").find(":checked").length;s?$("#claimprinttable >tbody>tr").find('input[name="flexCheckDefault"]:checked').each(function(){var e={ticketno:$(this).parents("tr").attr("id")},t=2e3;$.ajax({url:"/delete",method:"post",dataType:"json",data:e,success:function(a){a.success==!0?($(".message").text(a.message),$("#alertmessage").removeClass("alert-danger"),$("#alertmessage").addClass("alert-success"),$("#alertmessage").css("display","block").fadeOut(3e3),setTimeout(function(){$('input[type="checkbox"]').removeAttr("checked"),document.location.reload()},t)):($(".message").text(a.message),$("#alertmessage").removeClass("alert-success"),$("#alertmessage").addClass("alert-danger"),$("#alertmessage").css("display","block").fadeOut(3e3))},error:function(a){console.log("Error sending data."),console.log(a)}})}):($(".message").text("Select at least one claim."),$("#alertmessage").removeClass("alert-success"),$("#alertmessage").addClass("alert-danger"),$("#alertmessage").css("display","block").fadeOut(3e3))});$("#printclaimpreviewbtn").click(function(s){s.preventDefault();var e=$("#totalamounttxt").text().replace("KES. ",""),t=parseFloat(e.replace(",","")),a=$("#claimprinttable >tbody >tr").length;if(t==null||t==0)$(".message").text("Claim amount should be greater than 0."),$(".spinner-border").removeClass("text-success"),$(".spinner-border").addClass("text-danger"),$("#alertmessage").removeClass("alert-success"),$("#alertmessage").addClass("alert-danger"),$("#alertmessage").css("display","block").fadeOut(5e3);else if(a>5)$(".message").text("You can print a maximum of 5 service ticket claims."),$(".spinner-border").removeClass("text-success"),$(".spinner-border").addClass("text-danger"),$("#alertmessage").removeClass("alert-success"),$("#alertmessage").addClass("alert-danger"),$("#alertmessage").css("display","block").fadeOut(4e3);else{var n,l,r,i,c,o,p,u,m,d={},f=[],a=$("#claimprinttable >tbody >tr").length;console.log("lenght: "+a);var h=new FormData;$("#claimprinttable").find("tbody").find("tr").each(function(){n=$(this).find("td:nth-child(3)").text(),p=$(this).find("td:nth-child(4)").text().replace(/\s/g,""),u=$(this).find("td:nth-child(5)").text().replace(/\s/g,""),l=$(this).find("td:nth-child(6)").text().replace(/\s/g,""),r=$(this).find("td:nth-child(7)").text(),i=$(this).find("td:nth-child(8)").text(),c=$(this).find("td:nth-child(9)").text(),o=$(this).find("td:nth-child(10)").text(),m=$(this).find("td:nth-child(11)").text().replace("KES. ",""),m=parseFloat(m.replace(",","")),d={ticketno:n,jobcardno:l,billingrefno:r,client:i,task:c,location:o,date:p,time:u,amount:m},f.push(d)}),h.append("claimsdata",JSON.stringify(f)),$.ajax({url:"/printpreview",method:"post",data:h,processData:!1,contentType:!1,success:function(g){g.success==!0&&($(".message").text(g.message),$("#alertmessage").removeClass("alert-danger"),$("#alertmessage").addClass("alert-success"),$("#alertmessage").css("display","block").fadeOut(5e3),setTimeout(function(){window.open("/printpreview","Print Claims","width=1200,height=900,scrollbars=yes")},2e3))}})}});$(document).ready(function(){var s=window.location.pathname;if(s=="/printpreview"){var e=new Date,t=e.getMonth()+1,a=e.getDate(),n=e.getFullYear()+((""+t).length<2?"0":"")+t+((""+a).length<2?"0":"")+a,l=Math.floor(Math.random()*1e4)+1;$("#claimno").text(n+"/"+l)}});$("#exitbtn").click(function(){$("#showprintout").css("display","none").fadeOut(2e3),$("#showclaimlist").fadeIn(2e3)});$("#printclaims").click(function(){var s=$("#claimno").text();$.ajax({url:"/resetprintclaims",data:{claimno:s},dataType:"json",method:"get",success:function(e){if(e.success==!0){var t="@page { size: landscape; }",a=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.media="print",n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t)),a.appendChild(n),window.print(),setTimeout(window.close,0)}},error:function(e){console.log("Error sending data."),console.log(e)}}),window.onfocus=function(){document.location.reload()}});$(document).ready(function(){var s=window.location.pathname;s=="/servicetickets"&&$("#serviceticketstable").DataTable(),s=="/dashboard"&&(console.log("path: "+s),$.ajax({url:"dashboardinfo",method:"get",dataType:"json",success:function(e){$.each(e,function(t,a){e[0]==null?$("#claimtotal").text("KES. 0.00"):$("#claimtotal").text("KES. "+$.number(e[0].totalclaim)),e[1]!==null&&$("#unupdatedclaims").text($.number(e[1].unupdatedclaims,0)+" Tickets"),e[2]!==null&&$("#pendingtickets").text($.number(e[2].pendingtickets,0)+" Tickets")})}}))});$(function(){$(".datepicker").datetimepicker({value:"",rtl:!1,format:"d-m-Y H:i",formatTime:"H:i",formatDate:"d-m-Y",step:30,monthChangeSpinner:!0,closeOnDateSelect:!1,closeOnTimeSelect:!0,closeOnWithoutClick:!0,closeOnInputClick:!0,openOnFocus:!0,timepicker:!0,datepicker:!0}),$(".dateonlypicker").datetimepicker({value:"",rtl:!1,format:"d-m-Y",formatTime:"H:i",formatDate:"d-m-Y",step:30,monthChangeSpinner:!0,closeOnDateSelect:!0,closeOnTimeSelect:!0,closeOnWithoutClick:!0,closeOnInputClick:!0,openOnFocus:!0,timepicker:!1,datepicker:!0})});$(function(){$("#newticketdate").datetimepicker({value:"",rtl:!1,format:"d-m-Y H:i",formatTime:"H:i",formatDate:"d-m-Y",step:30,monthChangeSpinner:!0,closeOnDateSelect:!1,closeOnTimeSelect:!0,closeOnWithoutClick:!0,closeOnInputClick:!0,openOnFocus:!0,timepicker:!0,datepicker:!0}),$(".csrdate").datetimepicker({value:"",rtl:!1,format:"d-m-Y",formatDate:"d-m-Y",monthChangeSpinner:!0,closeOnDateSelect:!1,closeOnWithoutClick:!0,closeOnInputClick:!0,openOnFocus:!0,timepicker:!1,datepicker:!0})});$(".exitupdate").on("click",function(s){s.preventDefault(),$("#ticketupdate").fadeOut(),$("#ticketupdate").css("display","none"),$("#ticketlist").fadeIn(2e3),document.location.reload()});$("#newticketbtn").on("click",function(s){s.preventDefault(),$("#ticketupdate").fadeOut(),$("#ticketupdate").css("display","none"),$("#ticketlist").fadeOut(),$("#newticket").fadeIn();var e=new Date,t=Math.floor(Math.random()*1e4)+1,a=e.getFullYear(),n=parseFloat(e.getMonth())+1,l=e.getDate(),r=a+""+n+l+"-"+t;$("#newticketno").val(r),$("#newticketno").css({"font-weight":"bold","text-align":"left"})});$("#attendancesbtn").on("click",function(s){s.preventDefault(),$("#ticketupdate").fadeOut(),$("#ticketlist").fadeOut(),$("#serviceattendances").fadeIn()});$("#serviceticketstable").on("click","tbody tr td",function(){var s=this.cellIndex,e=$(this).attr("class");if(console.log("td class"+e),s===1&&e=="text-center editing"){$("#ticketupdate").fadeOut(),$("#ticketupdate").css("display","none"),$("#ticketlist").fadeOut(),$("#newticket").fadeIn();var t=$(this).closest("tr").attr("id");console.log("ticketno: "+t),$.ajax({url:"searchticket",method:"post",dataType:"json",data:{ticketno:t},success:function(n){$("#newticketno").val(t),$("#newticketdate").val(moment(n[0].ticketdate).format("DD-MM-YYYY HH:mm")),$("#customername option:selected").val(n[0].clientid),$("#customername option:selected").text(n[0].clientname),$("#billing option:selected").val("csr"),$("#billingrefno").val(n[0].billingrefno),$("#faultreported").val(n[0].faultreported),$("#urgency option:selected").text(n[0].urgency),$("#urgency option:selected").val(n[0].urgency),$("#location").val(n[0].location),$("#technician option:selected").text(n[0].engineer),$("#technician option:selected").val(n[0].techid),$("#techlisttable tbody").empty(),$("#techlisttable").show();var l=$("#techlisttable tbody").length,r="<tr><td class='deleterow'><a class='text-danger' ><i class='fa fa-times' aria-hidden='true' style='font-size:10px;'></i></a></td><td>"+(l+1)+"</td><td>"+n[0].techid+"</td><td>"+n[0].engineer+"</td><td>"+n[0].idnumber+"</td><td>"+n[0].techemail+"</td><td>"+n[0].techphone+"</td></tr>";$("#techlisttable tbody").append(r)}})}else{$("#ticketlist").fadeOut(),$("#ticketlist").css("display","none"),$("#ticketupdate").fadeIn(1e3);var t=$(this).closest("tr").attr("id"),a=$(this).closest("tr").find("td:nth-child(5)").text();$.ajax({url:"showticket",type:"get",data:{ticketno:t,jobcardno:a},dataType:"json",beforeSend:function(){},success:function(l){$("#ticketno").text(l[0].ticketno);var r="Ticket # "+l[0].ticketno+" | "+l[0].clientname+" | "+moment(l[0].start_time).format("ddd d MMM, YYYY");if($("#cardtitle").text(r),$("#jobcardno").val(l[0].jobcardno),$("#site").val(l[0].location),l[0].start_time!="no update"&&$("#startdatetime").val(l[0].start_time),l[0].end_time!="no update"&&$("#enddatetime").val(l[0].end_time),$("#equipmodel").val(l[0].model),$("#serialno").val(l[0].serialno),$("#findings").val(l[0].findings),$("#action_taken").val(l[0].action_taken),$("#recommendations").val(l[0].recommendations),$("#ticketstatus option:selected").val(l[0].status),$("#ticketstatus option:selected").text(l[0].status),l[0].attachment!="no file found"){$(".filelist").css("display","block"),$("#filename").text(l[0].attachment);var i=/^((http|https|ftp):\/\/)/;i.test(l[0].attachment)&&$("#filename").attr("href",l[0].attachment)}},error:function(l){console.log("Error sending data."),console.log(l)}})}});$(document).on("submit","#ticketupdateform",function(s){s.preventDefault(),$("#ticketupdateform").parsley();var e=new Date($("#startdatetime").val().replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3")),t=new Date($("#enddatetime").val().replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3"));if($("#ticketupdateform").parsley().isValid())if(!$("#jobcardupload").val()&&!$("#filename").text())$("#alertmessage2").focus(),$(".message").text("Attach the job card."),$("#alertmessage2").removeClass("alert-success"),$("#alertmessage2").addClass("alert-danger"),$("#alertmessage2").css("display","block").fadeOut(1e4),$("#alertmessage2")[0].scrollIntoView();else if(moment(t).isBefore(moment(e)))$("#alertmessage2").focus(),$(".message").text("Start time should be earier than end time."),$("#alertmessage2").removeClass("alert-success"),$("#alertmessage2").addClass("alert-danger"),$("#alertmessage2").css("display","block").fadeOut(1e4),$("#alertmessage2")[0].scrollIntoView();else{var a=new FormData;a.append("ticketno",$("#ticketno").text()),a.append("jobcardno",$("#jobcardno").val()),a.append("city",$("#site").val()),a.append("start_time",moment(e).format("YYYY-MM-DD HH:mm:ss")),a.append("end_time",moment(t).format("YYYY-MM-DD HH:mm:ss")),a.append("model",$("#equipmodel").val()),a.append("serialno",$("#serialno").val()),a.append("findings",$("#findings").val()),a.append("action_taken",$("#action_taken").val()),a.append("recommendations",$("#recommendations").val()),a.append("status",$("#ticketstatus option:selected").val());var n=$("#jobcardupload")[0].files[0],l=$.trim($("#jobcardupload").val()),r=$("#jobcardupload").val().split("\\").pop();r=$("#ticketno").text()+"- "+$("#jobcardno").val()+"-"+r,r!=null&&l!==""&&l?(a.append("attachment",n),a.append("filename",r)):(r=$("#filename").text(),a.append("filename",r));var i=$("#submitupdate").clone();$.ajax({url:"ticket/update",type:"post",data:a,dataType:"json",processData:!1,contentType:!1,beforeSend:function(){var c='<div class="spinner-border spinner-border-sm text-light fs-5" role="status"><span class="visually-hidden"> Loading...</span></div>';$("#submitupdate").html(c+" Updating...")},success:function(c){$("#submitupdate").replaceWith(i),c.success==!0?($(".message").text(c.message),$("#alertmessage2").removeClass("alert-danger"),$("#alertmessage2").addClass("alert-success"),$("#alertmessage2").css("display","block").fadeOut(5e3),$(".top-row")[0].scrollIntoView(),$("#ticketupdateform")[0].reset(),$("#ticketupdateform").parsley().reset()):($("#submitupdate").replaceWith(i),$(".message").text(c.message),$("#alertmessage2").removeClass("alert-success"),$("#alertmessage2").addClass("alert-danger"),$("#alertmessage2").css("display","block").fadeOut(5e3),$("#alertmessage2")[0].scrollIntoView())},error:function(c){$("#submitupdate").replaceWith(i),console.log("error occured")}})}});$("#downloadjobcardbtn").on("click",function(s){s.preventDefault();var e=$("#filename").text();$.ajax({url:"ticket/checkfile?filename="+e,type:"get",success:function(t){t.success==!0?(window.location.href="ticket/downloadjobcard?filename="+e,$(".message").text(t.message),$("#alertmessage2").removeClass("alert-danger"),$("#alertmessage2").addClass("alert-success"),$("#alertmessage2").css("display","block").fadeOut(5e3),$(".top-row")[0].scrollIntoView()):($(".message").text(t.message),$("#alertmessage2").removeClass("alert-success"),$("#alertmessage2").addClass("alert-danger"),$("#alertmessage2").css("display","block").fadeOut(5e3),$(".top-row")[0].scrollIntoView())}})});$("#projectslist_table").DataTable();$("#claimprinttable").DataTable();$("#stocklisttable").DataTable({dom:"Bfrtip",buttons:{buttons:[{extend:"copy",className:"btn btn-primary"},{extend:"excel",className:"btn btn-success"},{extend:"pdf",className:"btn btn-dark"},{extend:"print",className:"btn btn-danger"}],dom:{button:{className:"btn"}}}});$("#issuepartsinventorytable").DataTable({dom:"Bfrtip",buttons:{buttons:[{extend:"copy",className:"btn btn-primary"},{extend:"excel",className:"btn btn-success"},{extend:"pdf",className:"btn btn-dark"},{extend:"print",className:"btn btn-danger"}],dom:{button:{className:"btn"}}}});$("#partshistorytable").DataTable({dom:"Bfrtip",buttons:{buttons:[{extend:"copy",className:"btn btn-primary"},{extend:"excel",className:"btn btn-success"},{extend:"pdf",className:"btn btn-dark"},{extend:"print",className:"btn btn-danger"}],dom:{button:{className:"btn"}}}});$("#csrtable").DataTable({dom:"Bfrtip",buttons:{buttons:[{extend:"copy",className:"btn btn-primary"},{extend:"excel",className:"btn btn-success"},{extend:"pdf",className:"btn btn-dark"},{extend:"print",className:"btn btn-danger"}],dom:{button:{className:"btn"}}}});var b=[],k=[];$(document).ready(function(){$.ajax({url:"/partslist",type:"get",dataType:"json",success:function(s){$.each(s,function(e,t){k.push({Key:t.partno,Value:t.description}),b.push(t.partno)})}})});$(function(){$(".partnosearch").autocomplete({source:function(s,e){var t=$.ui.autocomplete.filter(b,s.term);e(t.slice(0,10))}})});$(function(){$(".partnosearch").on("keypress",function(s){s.which===13&&(s.preventDefault(),$.each(k,function(){this.Key,this.Key===$(".partnosearch").val()&&$("#stockdescription").val(this.Value)}))})});$(document).ready(function(){$("#issuedpartstable tbody").on("click","td",function(){if($(this).attr("class")=="td-remove"){$(this).closest("tr").remove();for(var s=$("#issuedpartstable >tbody >tr").length,e=1;e<=s;e++)$("#issuedpartstable tbody tr:nth-child("+e+")").find("td:nth-child(2)").html(e)}})});$("#issuepartsinventorytable").on("click","tbody tr",function(){var s=$(this).find("td:nth-child(2)").html(),e=$(this).find("td:nth-child(3)").html(),t=$(this).find("td:nth-child(4)").html(),a=$(this).find("td:nth-child(5)").html(),n=$("#alertmessage3").offset().top,l=$("#issuedpartstable >tbody >tr").length,r="<tr><td class='td-remove'><button class='del-item'><i class='fa fa-times text-danger' aria-hidden='true'></i></button></td><td>"+(l+1)+"</td><td>"+s+"</td><td>"+e+"</td><td>"+t+"</td><td contenteditable='false'>1</td></tr>";if(l==0)$(window).scrollTop(n),a<1?($("#alertmessage3").css("display","block").fadeOut(3e3),$("#alertmessage3").removeClass("alert-success"),$("#alertmessage3").addClass("alert-danger"),$(".message").text("Stock item is out of stock.")):($("#issuedpartstable tbody").append(r),$("#alertmessage3").css("display","block").fadeOut(3e3),$("#alertmessage3").removeClass("alert-danger"),$("#alertmessage3").addClass("alert-success"),$(".message").text("Part added successfully"));else{for(let o=1;o<=l;o++){var i=$("#issuedpartstable tbody tr:nth-child("+o+")").find("td:nth-child(3)").html(),c=$("#issuedpartstable tbody tr:nth-child("+o+")").find("td:nth-child(6)").html();if(i===s){if(a<=c)console.log("available qty: "+a),$(window).scrollTop(n),$("#alertmessage3").css("display","block").fadeOut(3e3),$("#alertmessage3").removeClass("alert-success"),$("#alertmessage3").addClass("alert-danger"),$(".message").text("Stock item has only "+a+" pieces left.");else return $(window).scrollTop(n),c=parseInt(c)+1,$("#issuedpartstable tbody tr:nth-child("+o+")").find("td:nth-child(6)").html(c),$("#alertmessage3").css("display","block").fadeOut(3e3),$("#alertmessage3").removeClass("alert-danger"),$("#alertmessage3").addClass("alert-success"),$(".message").text("Part added successfully"),!1;return!0}}$(window).scrollTop(n),$("#issuedpartstable tbody").append(r),$("#alertmessage3").removeClass("alert-danger"),$("#alertmessage3").addClass("alert-success"),$(".message").text("Part added successfully")}});var y=[],x=[];$(document).ready(function(){$.ajax({url:"/getclients",method:"get",dataType:"json",success:function(s){var e=null;$.each(s,function(t,a){e="<option value='"+a.id+"' >"+a.clientname+"</option>",$("#clientid").append(e),$(".customername").append(e),x.push(a.clientname),y.push({Key:a.id,Value:a.clientname})})}})});$(function(){$(".clientname").autocomplete({source:function(s,e){var t=$.ui.autocomplete.filter(x,s.term);e(t.slice(0,10))}})});$(function(){$(".clientname").on("keypress",function(s){s.which===13&&(s.preventDefault(),$.each(y,function(){this.Value===$(".clientname").val()&&$("#clientid").text(this.Key)}))})});$(document).on("submit","#partregisterform",function(s){if(s.preventDefault(),$("#partregisterform").parsley(),$("#partregisterform").parsley().isValid()){var e=new FormData,t=$('input[name="lockstatus"]:checked').val();e.append("status",t),e.append("partno",$("#partno").val()),e.append("description",$("#description").val()),$.ajax({url:"/addpartsinventory",method:"post",data:e,processData:!1,contentType:!1,success:function(a){$(".message").text(a.message),$("#alertmessage2").removeClass("alert-danger"),$("#alertmessage2").addClass("alert-success"),$("#alertmessage2").css("display","block").fadeOut(3e3),$("#partregisterform")[0].reset(),setTimeout(function(){document.location.reload()},3e3)},error:function(a){console.log("error occured"),$(".message").text(response.message),$("#alertmessage2").addClass("alert-danger"),$("#alertmessage2").removeClass("alert-success"),$("#alertmessage2").css("display","block").fadeOut(5e3)}})}});$(document).on("submit","#issuepartform",function(s){if(s.preventDefault(),$("#issuepartform").parsley(),$("#issuepartform").parsley().isValid()){var e=$("#issuedpartstable >tbody >tr").length;if(console.log("rows found: "+e),e==0||e==null)$(".message").text("Add at least one part"),$("#alertmessage3").removeClass("alert-success"),$("#alertmessage3").addClass("alert-danger"),$("#alertmessage3").css("display","block").fadeOut(3e3);else{for(var t=new FormData,a=[],n=$("#ticketclientname").val(),l=$("#assignedticketno").val(),r=$("#issuedto option:selected").val(),i=new Date($("#assignedon").val().replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3")),c=moment(i).format("YYYY-MM-DD HH:mm:ss"),o,p,u,m,e=$("#issuedpartstable tbody tr").length,d=1;d<=e;d++)m=$("#issuedpartstable tbody tr:nth-child("+d+")").find("td:nth-child(3)").html(),o=$("#issuedpartstable tbody tr:nth-child("+d+")").find("td:nth-child(4)").html(),p=$("#issuedpartstable tbody tr:nth-child("+d+")").find("td:nth-child(6)").html(),u={ticketno:l,client:n,issuedto:r,partno:o,quantity:p,issuedon:c,stockid:m},a.push(u);t.append("items",JSON.stringify(a));var f=$("#issuepartsbtn").clone();$.ajax({url:"/issueparts",method:"post",data:t,processData:!1,contentType:!1,beforeSend:function(){var v='<div class="spinner-border text-light fs-5" role="status"><span class="visually-hidden"> Loading...</span></div>';$("#issuepartsbtn").html(v+"Processing...")},dataType:"json",success:function(v){$("#issuepartsbtn").replaceWith(f),$(".message").text(v.message),$("#alertmessage3").removeClass("alert-danger"),$("#alertmessage3").addClass("alert-success"),$("#alertmessage3").css("display","block").fadeOut(3e3),$("#issuepartform")[0].reset(),$("#issuedpartstable tbody tr").remove(),setTimeout(function(){document.location.reload()},3e3)},error:function(v){$("#issuepartsbtn").replaceWith(f)}})}}});$(document).on("submit","#partstockform",function(s){if(s.preventDefault(),$("#partstockform").parsley(),$("#partstockform").parsley().isValid()){var e=new FormData;e.append("client",$("#clientid").text()),e.append("partno",$("#stockpartno").val()),e.append("quantity",$("#partqty").val()),e.append("refno",$("#refno").val()),e.append("ticketno",$("#ticketno").val());var t=new Date($("#datereceived").val().replace(/(\d{2})-(\d{2})-(\d{4})/,"$2/$1/$3"));e.append("receivedon",moment(t).format("YYYY-MM-DD HH:mm:ss")),$.ajax({url:"/addstock",type:"post",data:e,dataType:"json",processData:!1,contentType:!1,success:function(a){$(".message").text(a.message),$("#alertmessage").removeClass("alert-danger"),$("#alertmessage").addClass("alert-success"),$("#alertmessage").css("display","block").fadeOut(3e3),$("#partstockform")[0].reset(),setTimeout(function(){document.location.reload()},3e3)},error:function(a){$(".message").text(response.message),$("#alertmessage").addClass("alert-danger"),$("#alertmessage").removeClass("alert-success"),$("#alertmessage").css("display","block").fadeOut(3e3)}})}});$(document).ready(function(){var s=window.location.pathname;s=="/dashboard"&&$.ajax({url:"/getCsrinfo",type:"get",success:function(e){var t;$.each(e,function(a,n){t="<tr><td>"+n.currency+". "+$.number(n.csrvalue,2)+"</td></tr>",$("#csrinfo tbody").append(t)})}})});$(function(){$(".action").on("click",function(){$("#wrapper").show(),$(this).attr("id")=="viewstock"&&($("#collapseWidth").css({display:"block"}),$("#wrapper").children().hide(),$("#viewstocklist").css({display:"block"}),$("#inventorymngmnt").css({display:"none"})),$(this).attr("id")=="trackparts"?($("#collapseWidth").css({display:"block"}),$("#wrapper").children().hide(),$("#trackpartsection").css({display:"block"}),$("#inventorymngmnt").css({display:"none"})):$(this).attr("id")=="issueparts"&&($("#collapseWidth").css({display:"block"}),$("#wrapper").children().hide(),$("#inventorymngmnt").css({display:"none"}),$("#issuepartssection").show())})});$(".direct").on("click",function(){$("#wrapper").children().hide(),$("#wrapper").css({display:"none"}),$("#inventorymngmnt").css({display:"block"})});$(function(){$("#ticketpartno").on("keypress",function(s){s.which=="13"})});$(function(){var s;$.ajax({url:"/getusers",method:"get",dataType:"json",success:function(e){$.each(e,function(t,a){s="<option value='"+a.id+"' >"+a.name+"</option>",$("#issuedto").append(s),$("#salespersons1").append(s),$("#sendto").append(s),$(".technician").append(s)})}})});$(".goback").on("click",function(){$("#createcsrsection").hide(),$("#csrinfosection").show(),$("#csrpanel").children().hide(),$("#csrdisplay").show("#csrdisplay"),setTimeout(function(){window.location.reload()},500)});$(document).on("submit","#searchattendanceform",function(s){if(s.preventDefault(),$("#searchattendanceform").parsley(),$("#searchattendanceform").parsley().isValid()){var e=new FormData($("form#searchattendanceform")[0]);e.set("clientname",$("#clientname option:selected").text()),console.log(e),$.ajax({url:"searchattendances",method:"Post",data:e,processData:!1,contentType:!1,beforeSend:function(){var t='<div class="spinner-border text-info spinner-border-sm" role="status"><span class="visually-hidden"> Loading...</span></div>';$("#alertmessage3").removeClass("alert-success"),$("#alertmessage3").addClass("alert-info"),$(".message").html(t+" Searching..."),$("#alertmessage3").css("display","block"),$("#alertmessage3")[0].scrollIntoView()},success:function(t){console.log(t),t?($("#alertmessage3").removeClass("alert-success"),$("#alertmessage3").addClass("alert-info"),$(".message").html(t.length+" records found."),$("#alertmessage3").css("display","block").fadeOut("3000"),$("#alertmessage3")[0].scrollIntoView(),$("#tablecontainer").css("display","block")):($("#alertmessage3").removeClass("alert-success"),$("#alertmessage3").addClass("alert-info"),$(".message").html(" No record found."),$("#alertmessage3").css("display","block").fadeOut("3000"),$("#alertmessage3")[0].scrollIntoView())}}).done(function(t){$("#serviceentriestable").dataTable({aaData:t,bDestroy:!0,dom:"Bfrtip",buttons:{buttons:[{extend:"copy",className:"btn btn-primary",title:"service attendances"},{extend:"excel",className:"btn btn-success",title:"service attendances"},{extend:"pdf",className:"btn btn-dark",title:"service attendances"},{extend:"print",className:"btn btn-danger",title:"service attendances"}],dom:{button:{className:"btn"}}},columnDefs:[{searchable:!0,orderable:!0,targets:1,render:DataTable.render.ellipsis(5,!0)}],order:[[1,"asc"]],columns:[{render:function(a,n,l,r){return r.row+1}},{data:"ticketno"},{data:"jobcardno"},{data:"clientname"},{data:"city"},{data:"faultreported"},{data:"start_time",render:DataTable.render.datetime("D/M/YYYY hh:mm")},{data:"end_time",render:DataTable.render.datetime("D/M/YYYY hh:mm")},{data:"model"},{data:"serialno"},{data:"findings"},{data:"recommendations"},{data:"faultreported"}]})})}});$("#clearsearchform").on("click",function(s){s.preventDefault(),$("#searchattendanceform")[0].reset(),$(".message").html("")});
